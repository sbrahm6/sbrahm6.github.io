<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#000000" />
  <meta name="description" content="Project File Tree" />
  <title>File Tree Using JavaScript</title>
  <link rel="stylesheet" type="text/css" href="file-tree.css" />
  <script src="file-tree.js"></script>


  <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
  <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <style>
    .tmp {
      display: none;
    }

    body {
      font-family: monospace;
    }
  </style>
</head>

<body style="background-color: white;">
  <noscript>
    <h1>Please enable JavaScript.</h1>
  </noscript>

  <title>Project File Tree</title>
  <h1>Project Directory Tree </h1>
  <h2><a id="login" href="https://github.com/sbrahm6">**github.com/sbrahm6**</a></h2>





  <!-- <div class="mdc-select mdc-select--filled demo-width-class">
    <div class="mdc-select__anchor">
        <span class="mdc-select__ripple"></span>
        <span class="mdc-floating-label mdc-floating-label--float-above">Pick a Food Group</span>
        <span class="mdc-select__selected-text-container">
            <span class="mdc-select__selected-text">Vegetables</span>
        </span>
        <span class="mdc-select__dropdown-icon">
            <svg class="mdc-select__dropdown-icon-graphic" viewBox="7 10 10 5" focusable="false">
                <polygon class="mdc-select__dropdown-icon-inactive" stroke="none" fill-rule="evenodd"
                    points="7 10 12 15 17 10">
                </polygon>
                <polygon class="mdc-select__dropdown-icon-active" stroke="none" fill-rule="evenodd"
                    points="7 15 12 10 17 15">
                </polygon>
            </svg>
        </span>
        <span class="mdc-line-ripple"></span>
    </div>

    <div class="mdc-select__menu demo-width-class mdc-menu mdc-menu-surface">
        <ul class="mdc-list">
            <li class="mdc-list-item" data-value="">
                <span class="mdc-list-item__ripple"></span>
            </li>
            <li class="mdc-list-item" data-value="grains">
                <span class="mdc-list-item__ripple"></span>
                <span class="mdc-list-item__text">Bread, Cereal, Rice, and Pasta</span>
            </li>
            <li class="mdc-list-item mdc-list-item--selected" data-value="vegetables" aria-selected="true">
                <span class="mdc-list-item__ripple"></span>
                <span class="mdc-list-item__text">Vegetables</span>
            </li>
            <li class="mdc-list-item" data-value="fruit">
                <span class="mdc-list-item__ripple"></span>
                <span class="mdc-list-item__text">Fruit</span>
            </li>
        </ul>
    </div>
</div> -->

  <style>
    .mdc-select--outlined {
      min-width: 25em;
    }
  </style>


  <div class="mdc-select mdc-select--outlined ">
    <div class="mdc-select__anchor" aria-labelledby="outlined-select-label">
      <span class="mdc-notched-outline">
        <span class="mdc-notched-outline__leading"></span>
        <span class="mdc-notched-outline__notch">
          <span id="outlined-select-label" class="mdc-floating-label">Make a Selection</span>
        </span>
        <span class="mdc-notched-outline__trailing"></span>
      </span>
      <span class="mdc-select__selected-text-container">
        <span id="demo-selected-text" class="mdc-select__selected-text">IT202 - Multimedia & Web Design</span>
      </span>
      <span class="mdc-select__dropdown-icon">
        <svg class="mdc-select__dropdown-icon-graphic" viewBox="7 10 10 5" focusable="false">
          <polygon class="mdc-select__dropdown-icon-inactive" stroke="none" fill-rule="evenodd"
            points="7 10 12 15 17 10">
          </polygon>
          <polygon class="mdc-select__dropdown-icon-active" stroke="none" fill-rule="evenodd" points="7 15 12 10 17 15">
          </polygon>
        </svg>
      </span>
    </div>

    <div class="mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth">
      <ul class="mdc-list" role="listbox" aria-label="Food picker listbox">
        <li class="mdc-list-item" aria-selected="false" data-value="" role="option">
          <span class="mdc-list-item__ripple"></span>
        </li>
        <li class="mdc-list-item mdc-list-item--selected" aria-selected="true" data-value="it202" role="option">
          <span class="mdc-list-item__ripple"></span>
          <span class="mdc-list-item__text">
            IT202 - Multimedia & Web Design
          </span>
        </li>
        <li class="mdc-list-item" data-value="all" aria-selected="true">
          <span class="mdc-list-item__ripple"></span>
          <span class="mdc-list-item__text">ALL</span>
        </li>
        <!-- <li class="mdc-list-item" data-value="grains">
                    <span class="mdc-list-item__ripple"></span>
                    <span class="mdc-list-item__text">Grains</span>
                </li> -->

      </ul>
    </div>
  </div>


  <script>
    const select = mdc.select.MDCSelect.attachTo(document.querySelector('.mdc-select'));

    select.listen('MDCSelect:change', () => {
      console.log(`Selected option at index ${select.selectedIndex} with value "${select.value}"`);
    });

    console.log(select.value);
    const selectedValue = select.value;
  </script>


  <ul id="file-tree" class="file-tree">

    <li class="tmp">
      <span class="folder-name">template</span>
      <ul class="fileList">
        <li class=listItem><span><a class="link" href=""></a></span></li>
      </ul>
    </li>

    <li>
      <span class="folder-name">
        <h3>Projects</h3>
      </span>
      <ul class="projects">
        <!-- <li>
            <span class="folder-name">sub-folder</span>
            <ul>
              <li><span>file</span></li>
            </ul>
          </li> -->
      </ul>
    </li>

    <!-- <li>
      <span class="folder-name">Activities</span>
      <ul class="activities">

      </ul>
    </li> -->
  </ul>

  <script>
    const tree = document.querySelector("#file-tree");
    const projects = document.querySelector(".projects");
    var projNum = 0;
    // const projects = ["IT202-Spring2021-project1", "IT202-Spring2021-project2"];
    const api = "https://api.github.com/repos/sbrahm6/";
    const gp = "https://sbrahm6.github.io/";

    // Proxy employed in order to bypass CORS(Cross Origin Requests) errors for local testing. 
    // Required more reserarch into how network processes, calls, headers and requests are handled.
    // const proxyURL = "";
    const proxyURL = "https://dry-everglades-33781.herokuapp.com/";
    const localProxy = "http://localhost:8080/";

    const tmp = document.querySelector(".tmp");

    const reposParentURL = fetch("https://api.github.com/users/sbrahm6/repos")
      .catch(() => {
        fetch(proxyURL + "https://api.github.com/users/sbrahm6/repos")
      })
      .then(res => res.json()).then((data) => {
        const length = data.length;

        // const repos = Array.from(data, (item) => item.name);
        // const repoURL = Array.from(data, (item) => item.html_url);
        // const apiURL = Array.from(data, (item) => item.url);

        for (let item of data) {

          let proj = item.name;
          if (!proj.match(/202/i)) { continue };
          // console.log(proj);
          projNum++;

          const clone = tmp.cloneNode(true);
          const li = clone.querySelector(".listItem").cloneNode(true);

          // clone.classList.add("project");
          const ul = clone.querySelector(".fileList");
          const link = clone.querySelector(".link");


          (async () => {
            const response = await fetch(api + proj);
            //   .catch(() => {
            //     fetch(proxyURL + api + proj);
            //     console.log(" 222 ");
            //   });
            const data = await response.json();

            const href = `${data.html_url}`;
            const name = `${data.name}`;
            clone.querySelector(".folder-name").innerText = name;
            // link.before(name + " - ");


            link.innerText = "Repository";
            link.href = href;
            // console.log(gp + name);

            try {
              console.log(deployment.ok, " TRY ");
              var deployment = await fetch(gp + name);
            } catch (e) {
              var deployment = await fetch(proxyURL + gp + name);
              // console.log(deployment.ok, " CATCH ");
            } finally {
              // console.log(deployment.ok, " FINALLY ");
              if (deployment.ok) {
                // console.log(deployment.status);
                li.querySelector(".link").href = gp + name;
                // li.querySelector(".link").before(name + " - ");
                li.querySelector(".link").innerText = "GithubPages Deployment";
                ul.appendChild(li);
              }
            }
          })();

          // CODE BELOW ADJUSTED DUE TO ASYNC OPERATION
          // let lineItem = li.cloneNode(true);
          // console.log(Object.isSealed(lineItem),  Object.isSealed(li));
          clone.classList.remove("tmp");
          projects.appendChild(clone);

        }
        // **import and initialize fileTree function** 
        fileTree('file-tree');
        // console.log(projNum);

      }).catch(err => console.log("CAUGHT ERROR", err));

  </script>
</body>

</html>